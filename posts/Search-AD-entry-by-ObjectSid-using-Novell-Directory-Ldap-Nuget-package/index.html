<!doctype html><html lang="en" data-mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.3.2" /><meta property="og:title" content="C# Search AD entry by ObjectSid using Novell Directory Ldap Nuget package" /><meta property="og:locale" content="en" /><meta name="description" content="SID stands for security identifier, a unique string that Windows Server automatically assigns to each computer, user and group in order to mark and clearly distinguish them." /><meta property="og:description" content="SID stands for security identifier, a unique string that Windows Server automatically assigns to each computer, user and group in order to mark and clearly distinguish them." /><link rel="canonical" href="/posts/Search-AD-entry-by-ObjectSid-using-Novell-Directory-Ldap-Nuget-package/" /><meta property="og:url" content="/posts/Search-AD-entry-by-ObjectSid-using-Novell-Directory-Ldap-Nuget-package/" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2023-09-25T00:00:00+02:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="C# Search AD entry by ObjectSid using Novell Directory Ldap Nuget package" /><meta name="twitter:site" content="@hbolajraf" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2023-11-03T22:24:18+01:00","datePublished":"2023-09-25T00:00:00+02:00","description":"SID stands for security identifier, a unique string that Windows Server automatically assigns to each computer, user and group in order to mark and clearly distinguish them.","headline":"C# Search AD entry by ObjectSid using Novell Directory Ldap Nuget package","mainEntityOfPage":{"@type":"WebPage","@id":"/posts/Search-AD-entry-by-ObjectSid-using-Novell-Directory-Ldap-Nuget-package/"},"url":"/posts/Search-AD-entry-by-ObjectSid-using-Novell-Directory-Ldap-Nuget-package/"}</script><title>C# | Search AD entry by ObjectSid using Novell Directory Ldap Nuget package |</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content=""><meta name="application-name" content=""><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.21.1/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script async src="https://www.googletagmanager.com/gtag/js?id=G-KPL0Y67SYB"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-KPL0Y67SYB'); </script><body><aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end"><header class="profile-wrapper"> <a href="/" id="avatar" class="rounded-circle"> <img src="/assets/img/favicons/Owner.png" width="112" height="112" alt="avatar" onerror="this.style.display='none'"> </a><h1 class="site-title"> <a href="/"></a></h1><p class="site-subtitle fst-italic mb-0"><h4><b>Hassan BOLAJRAF</b></h4>Fostering a culture of code quality and collaboration for .NET enthusiasts</p></header><nav class="flex-column flex-grow-1 w-100 ps-0"><ul class="nav"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle"></i> <span>ABOUT</span> </a></ul></nav><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <a href="https://www.linkedin.com/in/hassan-bolajraf-56a3a420/" aria-label="linkedin" target="_blank" rel="noopener noreferrer" > <i class="fab fa-linkedin"></i> </a> <a href="https://twitter.com/hbolajraf" aria-label="twitter" target="_blank" rel="noopener noreferrer" > <i class="fa-brands fa-x-twitter"></i> </a> <a href="https://www.facebook.com/hbolajraf" aria-label="facebook" target="_blank" rel="noopener noreferrer" > <i class="fab fa-facebook"></i> </a> <a href="" aria-label="Youtube" target="_blank" rel="noopener noreferrer" > <i class="fab fa-youtube"></i> </a> <a href="javascript:location.href = 'mailto:' + ['hassan.bolajraf','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a></div></aside><div id="main-wrapper" class="d-flex justify-content-center"><div class="container px-xxl-5"><header id="topbar-wrapper" aria-label="Top Bar"><div id="topbar" class="d-flex align-items-center justify-content-between px-lg-3 h-100" ><nav id="breadcrumb" aria-label="Breadcrumb"> <span> <a href="/"> Home </a> </span> <span>C# | Search AD entry by ObjectSid using Novell Directory Ldap Nuget package</span></nav><button type="button" id="sidebar-trigger" class="btn btn-link"> <i class="fas fa-bars fa-fw"></i> </button><div id="topbar-title"> Post</div><button type="button" id="search-trigger" class="btn btn-link"> <i class="fas fa-search fa-fw"></i> </button> <search class="align-items-center ms-3 ms-lg-0"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..." > </search> <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button></div></header><div class="row"><main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4" ><article class="px-1"><header><h1 data-toc-skip>C# | Search AD entry by ObjectSid using Novell Directory Ldap Nuget package</h1><div class="post-meta text-muted"> <span> Posted <time data-ts="1695592800" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Sep 25, 2023 </time> </span> <span> Updated <time data-ts="1699046658" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Nov 3, 2023 </time> </span><div class="d-flex justify-content-between"> <span> By <em> <a href="https://twitter.com/hbolajraf">Hassan BOLAJRAF</a> </em> </span> <span class="readtime" data-bs-toggle="tooltip" data-bs-placement="bottom" title="771 words" > <em>4 min</em> read</span></div></div></header><div class="content"><p><strong>SID stands for security identifier, a unique string that Windows Server automatically assigns to each computer, user and group in order to mark and clearly distinguish them.</strong></p><p>Windows SID Format : SIDs always follow the same structure, with values separated by dashes:</p><p><a href="https://dev-to-uploads.s3.amazonaws.com/uploads/articles/w7rjov714wxv9po0fcj5.png" class="popup img-link "><img data-src="https://dev-to-uploads.s3.amazonaws.com/uploads/articles/w7rjov714wxv9po0fcj5.png" alt="Image description" class="lazyload" data-proofer-ignore></a></p><p><strong>Novell Directory Ldap</strong></p><p>Novell Directory Ldap nuget package allows you to connect to the active directory in order to perform CRUD actions on all AD objects, among other Users Groups and computers. it support both platforms windows and linux, so even if you are under kubernetes clusters on docker containers you will be able to manage AD objects.</p><p><strong>C# code practical case</strong></p><p>This exemple is based on a project that was created based on .Net 6 under Visual studio 2022 and with a docker support to manage Ad Objects within a linux docker container. The nuget package version that was used are the following :</p><div class="language-xml highlighter-rouge"><div class="code-header"> <span data-label-text="XML"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed=""><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nt">&lt;PackageReference</span> <span class="na">Include=</span><span class="s">"Novell.Directory.Ldap.NETStandard"</span> <span class="na">Version=</span><span class="s">"3.6.0"</span> <span class="nt">/&gt;</span>
</pre></table></code></div></div><p>When we will process a search within the AD for a dedicated entry we will use a string ObjectSid instead of a bytes value. To do that we will create a helper method that will return the string value based on the input ObjectSid bytes value as bellow :</p><p><strong>1. Add Helper method to convert ObjectSID Byte value in string format</strong></p><div class="language-cs highlighter-rouge"><div class="code-header"> <span data-label-text="C#"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed=""><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
</pre><td class="rouge-code"><pre> <span class="k">public</span> <span class="k">static</span> <span class="kt">string</span> <span class="nf">ConvertSidByteValueToStringValue</span><span class="p">(</span><span class="n">Byte</span><span class="p">[]</span> <span class="n">sidBytes</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="kt">short</span> <span class="n">sSubAuthorityCount</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
            <span class="n">StringBuilder</span> <span class="n">strSid</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">StringBuilder</span><span class="p">();</span>
            <span class="n">strSid</span><span class="p">.</span><span class="nf">Append</span><span class="p">(</span><span class="s">"S-"</span><span class="p">);</span>
            <span class="k">try</span>
            <span class="p">{</span>
                <span class="c1">// Add SID revision.</span>
                <span class="n">strSid</span><span class="p">.</span><span class="nf">Append</span><span class="p">(</span><span class="n">sidBytes</span><span class="p">[</span><span class="m">0</span><span class="p">].</span><span class="nf">ToString</span><span class="p">());</span>

                <span class="n">sSubAuthorityCount</span> <span class="p">=</span> <span class="n">Convert</span><span class="p">.</span><span class="nf">ToInt16</span><span class="p">(</span><span class="n">sidBytes</span><span class="p">[</span><span class="m">1</span><span class="p">]);</span>

                <span class="c1">// Next six bytes are SID authority value.</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">sidBytes</span><span class="p">[</span><span class="m">2</span><span class="p">]</span> <span class="p">!=</span> <span class="m">0</span> <span class="p">||</span> <span class="n">sidBytes</span><span class="p">[</span><span class="m">3</span><span class="p">]</span> <span class="p">!=</span> <span class="m">0</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="kt">string</span> <span class="n">strAuth</span> <span class="p">=</span> <span class="n">String</span><span class="p">.</span><span class="nf">Format</span><span class="p">(</span><span class="s">"0x{0:2x}{1:2x}{2:2x}{3:2x}{4:2x}{5:2x}"</span><span class="p">,</span>
                                   <span class="p">(</span><span class="n">Int16</span><span class="p">)</span><span class="n">sidBytes</span><span class="p">[</span><span class="m">2</span><span class="p">],</span>
                                   <span class="p">(</span><span class="n">Int16</span><span class="p">)</span><span class="n">sidBytes</span><span class="p">[</span><span class="m">3</span><span class="p">],</span>
                                   <span class="p">(</span><span class="n">Int16</span><span class="p">)</span><span class="n">sidBytes</span><span class="p">[</span><span class="m">4</span><span class="p">],</span>
                                   <span class="p">(</span><span class="n">Int16</span><span class="p">)</span><span class="n">sidBytes</span><span class="p">[</span><span class="m">5</span><span class="p">],</span>
                                   <span class="p">(</span><span class="n">Int16</span><span class="p">)</span><span class="n">sidBytes</span><span class="p">[</span><span class="m">6</span><span class="p">],</span>
                                   <span class="p">(</span><span class="n">Int16</span><span class="p">)</span><span class="n">sidBytes</span><span class="p">[</span><span class="m">7</span><span class="p">]);</span>
                    <span class="n">strSid</span><span class="p">.</span><span class="nf">Append</span><span class="p">(</span><span class="s">"-"</span><span class="p">);</span>
                    <span class="n">strSid</span><span class="p">.</span><span class="nf">Append</span><span class="p">(</span><span class="n">strAuth</span><span class="p">);</span>
                <span class="p">}</span>
                <span class="k">else</span>
                <span class="p">{</span>
                    <span class="n">Int64</span> <span class="n">iVal</span> <span class="p">=</span> <span class="n">sidBytes</span><span class="p">[</span><span class="m">7</span><span class="p">]</span> <span class="p">+</span>
                         <span class="p">(</span><span class="n">sidBytes</span><span class="p">[</span><span class="m">6</span><span class="p">]</span> <span class="p">&lt;&lt;</span> <span class="m">8</span><span class="p">)</span> <span class="p">+</span>
                         <span class="p">(</span><span class="n">sidBytes</span><span class="p">[</span><span class="m">5</span><span class="p">]</span> <span class="p">&lt;&lt;</span> <span class="m">16</span><span class="p">)</span> <span class="p">+</span>
                         <span class="p">(</span><span class="n">sidBytes</span><span class="p">[</span><span class="m">4</span><span class="p">]</span> <span class="p">&lt;&lt;</span> <span class="m">24</span><span class="p">);</span>
                    <span class="n">strSid</span><span class="p">.</span><span class="nf">Append</span><span class="p">(</span><span class="s">"-"</span><span class="p">);</span>
                    <span class="n">strSid</span><span class="p">.</span><span class="nf">Append</span><span class="p">(</span><span class="n">iVal</span><span class="p">.</span><span class="nf">ToString</span><span class="p">());</span>
                <span class="p">}</span>

                <span class="c1">// Get sub authority count...</span>
                <span class="kt">int</span> <span class="n">idxAuth</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
                <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">sSubAuthorityCount</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
                <span class="p">{</span>
                    <span class="n">idxAuth</span> <span class="p">=</span> <span class="m">8</span> <span class="p">+</span> <span class="n">i</span> <span class="p">*</span> <span class="m">4</span><span class="p">;</span>
                    <span class="n">UInt32</span> <span class="n">iSubAuth</span> <span class="p">=</span> <span class="n">BitConverter</span><span class="p">.</span><span class="nf">ToUInt32</span><span class="p">(</span><span class="n">sidBytes</span><span class="p">,</span> <span class="n">idxAuth</span><span class="p">);</span>
                    <span class="n">strSid</span><span class="p">.</span><span class="nf">Append</span><span class="p">(</span><span class="s">"-"</span><span class="p">);</span>
                    <span class="n">strSid</span><span class="p">.</span><span class="nf">Append</span><span class="p">(</span><span class="n">iSubAuth</span><span class="p">.</span><span class="nf">ToString</span><span class="p">());</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">Trace</span><span class="p">.</span><span class="nf">TraceWarning</span><span class="p">(</span><span class="n">ex</span><span class="p">.</span><span class="n">Message</span><span class="p">);</span>
                <span class="k">throw</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="k">return</span> <span class="n">strSid</span><span class="p">.</span><span class="nf">ToString</span><span class="p">();</span>
        <span class="p">}</span>
</pre></table></code></div></div><p>This method will get <strong>ObjectSid</strong> information parts from the array of Bytes input value as bellow :</p><div class="language-cs highlighter-rouge"><div class="code-header"> <span data-label-text="C#"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed=""><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="kt">byte</span><span class="p">[</span><span class="m">0</span><span class="p">]</span>      <span class="p">-</span> <span class="n">Revision</span> <span class="n">Level</span>
<span class="kt">byte</span><span class="p">[</span><span class="m">1</span><span class="p">]</span>      <span class="p">-</span> <span class="n">count</span> <span class="n">of</span> <span class="n">Sub</span><span class="p">-</span><span class="n">Authorities</span>
<span class="kt">byte</span><span class="p">[</span><span class="m">2</span> <span class="p">-</span> <span class="m">7</span><span class="p">]</span>  <span class="p">-</span> <span class="m">48</span> <span class="n">bit</span> <span class="nf">Authority</span><span class="p">(</span><span class="n">big</span><span class="p">-</span><span class="n">endian</span><span class="p">)</span>
<span class="kt">byte</span><span class="p">[</span><span class="m">8</span> <span class="p">+]</span>    <span class="p">-</span> <span class="n">n</span> <span class="n">Sub</span><span class="p">-</span><span class="n">Authorities</span><span class="p">,</span> <span class="m">32</span> <span class="n">bits</span> 
</pre></table></code></div></div><p>And after that we return a String <strong>ObjectSID</strong> on the format bellow :</p><div class="language-cs highlighter-rouge"><div class="code-header"> <span data-label-text="C#"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed=""><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">S</span><span class="p">-{</span><span class="n">Revision</span><span class="p">}-{</span><span class="n">Authority</span><span class="p">}-{</span> <span class="n">SubAuthority1</span><span class="p">}-{</span> <span class="n">SubAuthority2</span><span class="p">}...-{</span> <span class="n">SubAuthorityN</span><span class="p">}</span>
</pre></table></code></div></div><p><strong>2. Call Active Directory to retrieve User informations based on objectSid string value</strong></p><p><strong>Adding Novell directive</strong></p><div class="language-c# highlighter-rouge"><div class="code-header"> <span data-label-text="C#"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed=""><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="k">using</span> <span class="nn">Novell.Directory.Ldap</span><span class="p">;</span>
<span class="p">.....</span>
</pre></table></code></div></div><p><strong>Adding the search method to get the User entry object</strong></p><div class="language-c# highlighter-rouge"><div class="code-header"> <span data-label-text="C#"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed=""><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
</pre><td class="rouge-code"><pre><span class="c1">/// Exemple of Dn Value  : OU=User,OU=Accounts,DC=USA,DC=NY</span>
        <span class="c1">/// Exemple of objectSidStringValue Value  : S-1-5-15-420314761-778715008-4547327-1845947</span>
        <span class="c1">/// Exemple of objectCategory Value  : User or Group or Computer</span>
        <span class="c1">/// Exemple of OutputProps Values : "description","lastLogon","email","name", "login"</span>
        <span class="k">public</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Attributes</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="kt">string</span><span class="p">&gt;&gt;?</span> <span class="nf">GetLdapEntryByObjectSid</span><span class="p">(</span><span class="kt">string</span> <span class="n">Dn</span><span class="p">,</span> <span class="kt">string</span> <span class="n">objectSidStringValue</span><span class="p">,</span> <span class="kt">string</span> <span class="n">objectCategory</span><span class="p">,</span> <span class="kt">string</span><span class="p">[]</span> <span class="n">OutputProps</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">ldapConnectionOptions</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">LdapConnectionOptions</span><span class="p">();</span>
            <span class="n">ldapConnectionOptions</span><span class="p">.</span><span class="nf">UseSsl</span><span class="p">();</span>
            <span class="kt">var</span> <span class="n">ldapConx</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">LdapConnection</span><span class="p">(</span><span class="n">ldapConnectionOptions</span><span class="p">);</span>

            <span class="n">List</span><span class="p">&lt;</span><span class="n">Attributes</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="kt">string</span><span class="p">&gt;&gt;</span> <span class="n">listAttributes</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Attributes</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="kt">string</span><span class="p">&gt;&gt;();</span>

            <span class="kt">string</span> <span class="n">Filter</span> <span class="p">=</span> <span class="s">$"(&amp;(objectSid=</span><span class="p">{</span><span class="n">objectSidStringValue</span><span class="p">}</span><span class="s">)(objectCategory=</span><span class="p">{</span><span class="n">objectCategory</span><span class="p">}</span><span class="s">))"</span><span class="p">;</span>
            

            <span class="k">if</span> <span class="p">(!</span><span class="kt">string</span><span class="p">.</span><span class="nf">IsNullOrEmpty</span><span class="p">(</span><span class="n">Filter</span><span class="p">))</span>
            <span class="p">{</span>
                <span class="kt">var</span> <span class="n">searchQuery</span> <span class="p">=</span> <span class="n">ldapConx</span><span class="p">.</span><span class="nf">Search</span><span class="p">(</span><span class="n">Dn</span><span class="p">,</span> <span class="n">Novell</span><span class="p">.</span><span class="n">Directory</span><span class="p">.</span><span class="n">Ldap</span><span class="p">.</span><span class="n">LdapConnection</span><span class="p">.</span><span class="n">ScopeSub</span><span class="p">,</span> <span class="n">Filter</span><span class="p">,</span> <span class="n">OutputProps</span><span class="p">,</span> <span class="k">false</span><span class="p">);</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">searchQuery</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="k">while</span> <span class="p">(</span><span class="n">searchQuery</span><span class="p">.</span><span class="nf">HasMore</span><span class="p">())</span>
                    <span class="p">{</span>
                        <span class="n">LdapEntry</span> <span class="n">nextEntry</span> <span class="p">=</span> <span class="k">null</span><span class="p">;</span>
                            <span class="n">nextEntry</span> <span class="p">=</span> <span class="n">searchQuery</span><span class="p">.</span><span class="nf">Next</span><span class="p">();</span>

                            <span class="c1">//SID Case </span>
                            <span class="k">if</span> <span class="p">(</span><span class="n">OutputProps</span><span class="p">.</span><span class="nf">Contains</span><span class="p">(</span><span class="s">"objectSid"</span><span class="p">))</span>
                            <span class="p">{</span>
                                <span class="c1">//Get Sid Property Bytes value to be converted into string clear value</span>
                                <span class="kt">var</span> <span class="n">objectSid</span> <span class="p">=</span> <span class="n">nextEntry</span><span class="p">.</span><span class="nf">GetAttributeSet</span><span class="p">().</span><span class="nf">FirstOrDefault</span><span class="p">(</span><span class="n">e</span> <span class="p">=&gt;</span> <span class="n">e</span><span class="p">.</span><span class="n">Key</span><span class="p">.</span><span class="nf">Equals</span><span class="p">(</span><span class="s">"objectSid"</span><span class="p">));</span>
                                <span class="k">if</span> <span class="p">(</span><span class="n">objectSid</span><span class="p">.</span><span class="n">Value</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
                                <span class="p">{</span>
                                    <span class="kt">var</span> <span class="n">sidStringFormat</span> <span class="p">=</span> <span class="nf">ConvertSidByteValueToStringValue</span><span class="p">(</span><span class="n">objectSid</span><span class="p">.</span><span class="n">Value</span><span class="p">.</span><span class="n">ByteValue</span><span class="p">);</span>
                                    <span class="n">listAttributes</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="k">new</span> <span class="n">Attributes</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="kt">string</span><span class="p">&gt;(</span><span class="n">objectSid</span><span class="p">.</span><span class="n">Key</span><span class="p">,</span> <span class="n">sidStringFormat</span><span class="p">));</span>
                                <span class="p">}</span>
                            <span class="p">}</span>

                            <span class="n">listAttributes</span><span class="p">.</span><span class="nf">AddRange</span><span class="p">(</span><span class="n">nextEntry</span><span class="p">.</span><span class="nf">GetAttributeSet</span><span class="p">()</span>
                                <span class="p">.</span><span class="nf">Where</span><span class="p">(</span><span class="n">e</span> <span class="p">=&gt;</span> <span class="p">!</span><span class="n">e</span><span class="p">.</span><span class="n">Key</span><span class="p">.</span><span class="nf">Equals</span><span class="p">(</span><span class="s">"objectSid"</span><span class="p">))</span>
                                <span class="p">.</span><span class="nf">Select</span><span class="p">(</span><span class="n">e</span> <span class="p">=&gt;</span> <span class="k">new</span> <span class="n">Attributes</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="kt">string</span><span class="p">&gt;(</span><span class="n">e</span><span class="p">.</span><span class="n">Key</span><span class="p">,</span> <span class="n">e</span><span class="p">.</span><span class="n">Value</span><span class="p">.</span><span class="n">StringValue</span><span class="p">))</span>
                                <span class="p">.</span><span class="nf">ToList</span><span class="p">());</span>                       
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>

            <span class="k">return</span> <span class="n">listAttributes</span><span class="p">;</span>
        <span class="p">}</span>

</pre></table></code></div></div><p>The <strong>GetLdapEntryByObjectSid</strong> method will process a <strong>searchQuery</strong> within ldap based on the <strong>objectSid</strong> filter and also the objectCategory in this example <strong>User</strong> filter. As mentioned the objectSid within Active directory are persisted as a byte so we will call our Helper method to convert it into a string value:</p><div class="language-c# highlighter-rouge"><div class="code-header"> <span data-label-text="C#"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed=""><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre> <span class="kt">var</span> <span class="n">sidStringFormat</span> <span class="p">=</span> <span class="nf">ConvertSidByteValueToStringValue</span><span class="p">(</span><span class="n">objectSid</span><span class="p">.</span><span class="n">Value</span><span class="p">.</span><span class="n">ByteValue</span><span class="p">);</span>
</pre></table></code></div></div><p>The returned list of properties will contains all properties as string readable values, so we can use them also to process a new search based on other property.</p><p>Links : <a href="https://github.com/dsbenghe/Novell.Directory.Ldap.NETStandard">Novell Directory - GitHub repository</a> <a href="https://www.nuget.org/packages/Novell.Directory.Ldap.NETStandard/">Novell Directory - Nuget package</a></p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw me-1"></i> <a href="/categories/c/">C#</a>, <a href="/categories/active-directory/">Active Directory</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw me-1"></i> <a href="/tags/ldap/" class="post-tag no-text-decoration" >ldap</a> <a href="/tags/microsoft/" class="post-tag no-text-decoration" >microsoft</a> <a href="/tags/c/" class="post-tag no-text-decoration" >c#</a> <a href="/tags/dotnet/" class="post-tag no-text-decoration" >dotnet</a> <a href="/tags/activedirectory/" class="post-tag no-text-decoration" >activedirectory</a></div><div> <script src="https://giscus.app/client.js" data-repo="hbolajraf/hbolajraf.github.io" data-repo-id="R_kgDOKjs-PQ" data-category="Announcements" data-category-id="DIC_kwDOKjs-Pc4CazvF" data-mapping="title" data-strict="0" data-reactions-enabled="1" data-emit-metadata="1" data-input-position="top" data-theme="dark_dimmed" data-lang="en" crossorigin="anonymous" async> </script></div><div class=" post-tail-bottom d-flex justify-content-between align-items-center mt-5 pb-2 " ><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper d-flex align-items-center"> <span class="share-label text-muted me-1">Share</span> <span class="share-icons"> <a href="https://www.linkedin.com/sharing/share-offsite/?url=%2Fposts%2FSearch-AD-entry-by-ObjectSid-using-Novell-Directory-Ldap-Nuget-package%2F" data-bs-toggle="tooltip" data-bs-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin" > <i class="fa-fw fab fa-linkedin"></i> </a> <a href="https://twitter.com/intent/tweet?text=C#%20%7C%20Search%20AD%20entry%20by%20ObjectSid%20using%20Novell%20Directory%20Ldap%20Nuget%20package%20-%20&url=%2Fposts%2FSearch-AD-entry-by-ObjectSid-using-Novell-Directory-Ldap-Nuget-package%2F" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter" > <i class="fa-fw fa-brands fa-square-x-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=C#%20%7C%20Search%20AD%20entry%20by%20ObjectSid%20using%20Novell%20Directory%20Ldap%20Nuget%20package%20-%20&u=%2Fposts%2FSearch-AD-entry-by-ObjectSid-using-Novell-Directory-Ldap-Nuget-package%2F" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook" > <i class="fa-fw fab fa-facebook-square"></i> </a> <button id="copy-link" aria-label="Copy link" class="btn small" data-bs-toggle="tooltip" data-bs-placement="top" title="Copy link" data-title-succeed="Link copied successfully!" > <i class="fa-fw fas fa-link pe-none"></i> </button> </span></div></div></div></article></main><aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 text-muted"><div class="access"><section id="access-lastmod"><h2 class="panel-heading">Recently Updated</h2><ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2"><li class="text-truncate lh-lg"> <a href="/posts/C-GraphQL-in-.NET-Core-and-C/">C# | Building GraphQL APIs in C#</a><li class="text-truncate lh-lg"> <a href="/posts/AZ-400-Certification-Path/">Certification | AZ-400 Certification Path</a><li class="text-truncate lh-lg"> <a href="/posts/Configure-Swagger-For-Ocelot-Gateway/">C# | Configure Swagger on api gateway using ocelot in asp.net core application</a><li class="text-truncate lh-lg"> <a href="/posts/Search-AD-entry-by-ObjectSid-using-Novell-Directory-Ldap-Nuget-package/">C# | Search AD entry by ObjectSid using Novell Directory Ldap Nuget package</a><li class="text-truncate lh-lg"> <a href="/posts/Configure-QoS-within-API-Gateway-using-ocelot-and-Polly/">C# | Configure QoS within API Gateway using ocelot and Polly</a></ul></section><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/microsoft/">microsoft</a> <a class="post-tag btn btn-outline-primary" href="/tags/c/">c#</a> <a class="post-tag btn btn-outline-primary" href="/tags/csharp/">csharp</a> <a class="post-tag btn btn-outline-primary" href="/tags/azure/">azure</a> <a class="post-tag btn btn-outline-primary" href="/tags/azuredevops/">azuredevops</a> <a class="post-tag btn btn-outline-primary" href="/tags/bestpractices/">bestpractices</a> <a class="post-tag btn btn-outline-primary" href="/tags/webapi/">webapi</a> <a class="post-tag btn btn-outline-primary" href="/tags/aspnetcore/">aspnetcore</a> <a class="post-tag btn btn-outline-primary" href="/tags/tips-tricks/">tips&tricks</a> <a class="post-tag btn btn-outline-primary" href="/tags/github/">github</a></div></section></div></aside></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4"><aside id="related-posts" aria-labelledby="related-label"><h3 class="mb-4" id="related-label">Further Reading</h3><nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4"><article class="col"> <a href="/posts/Deploy-.net-core-NuGet-Packages-in-GitHub-Packages-Registry/" class="post-preview card h-100"><div class="card-body"> <time class="small" data-ts="1692396000" data-df="ll" > Aug 19, 2023 </time><h4 class="pt-0 my-2">GitHub | Deploy .net core NuGet Packages in GitHub Packages Registry</h4><div class="text-muted small"><p> Introduction GitHub packages registries is most popular now a days. It offers different packages registries for most used package managers, such as NuGet, npm, Docker etc. In this article, I will ...</p></div></div></a></article><article class="col"> <a href="/posts/AZ-400-Certification-Path/" class="post-preview card h-100"><div class="card-body"> <time class="small" data-ts="1694296800" data-df="ll" > Sep 10, 2023 </time><h4 class="pt-0 my-2">Certification | AZ-400 Certification Path</h4><div class="text-muted small"><p> Microsoft certification paths changes Both the MCSD and MCT certifications were discontinued by Microsoft in 2017. They were replaced by newer certification programs that reflect the changing de...</p></div></div></a></article><article class="col"> <a href="/posts/Azure-Build-.Net-IoT-App-using-C/" class="post-preview card h-100"><div class="card-body"> <time class="small" data-ts="1696370400" data-df="ll" > Oct 4, 2023 </time><h4 class="pt-0 my-2">Azure | Build .Net IoT App using C#</h4><div class="text-muted small"><p> Build .Net IoT App using C# Azure IoT provides a robust platform for building Internet of Things (IoT) solutions. Here are some C# examples to help you get started with Azure IoT services. Azure I...</p></div></div></a></article></nav></aside><nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation"> <a href="/posts/Configure-Swagger-For-Ocelot-Gateway/" class="btn btn-outline-primary" aria-label="Older" ><p>C# | Configure Swagger on api gateway using ocelot in asp.net core application</p></a> <a href="/posts/Configure-QoS-within-API-Gateway-using-ocelot-and-Polly/" class="btn btn-outline-primary" aria-label="Newer" ><p>C# | Configure QoS within API Gateway using ocelot and Polly</p></a></nav><footer aria-label="Site Info" class=" d-flex flex-column justify-content-center text-muted flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3 " ><p> © <time>2023</time> <a href="https://twitter.com/hbolajraf">Hassan BOLAJRAF</a>. <span data-bs-toggle="tooltip" data-bs-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author." >Some rights reserved.</span></p></footer></div></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-11 content"><div id="search-hints"><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/microsoft/">microsoft</a> <a class="post-tag btn btn-outline-primary" href="/tags/c/">c#</a> <a class="post-tag btn btn-outline-primary" href="/tags/csharp/">csharp</a> <a class="post-tag btn btn-outline-primary" href="/tags/azure/">azure</a> <a class="post-tag btn btn-outline-primary" href="/tags/azuredevops/">azuredevops</a> <a class="post-tag btn btn-outline-primary" href="/tags/bestpractices/">bestpractices</a> <a class="post-tag btn btn-outline-primary" href="/tags/webapi/">webapi</a> <a class="post-tag btn btn-outline-primary" href="/tags/aspnetcore/">aspnetcore</a> <a class="post-tag btn btn-outline-primary" href="/tags/tips-tricks/">tips&tricks</a> <a class="post-tag btn btn-outline-primary" href="/tags/github/">github</a></div></section></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><aside aria-label="Scroll to Top"> <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow"> <i class="fas fa-angle-up"></i> </button></aside></div><div id="mask"></div><aside id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-animation="true" data-bs-autohide="false" ><div class="toast-header"> <button type="button" class="btn-close ms-auto" data-bs-dismiss="toast" aria-label="Close" ></button></div><div class="toast-body text-center pt-0"><p class="px-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></aside><script src="https://cdn.jsdelivr.net/combine/npm/jquery@3.7.1/dist/jquery.min.js,npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js,npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/lazysizes@5.3.2/lazysizes.min.js,npm/magnific-popup@1.1.0/dist/jquery.magnific-popup.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.9/dayjs.min.js,npm/dayjs@1.11.9/locale/en.min.js,npm/dayjs@1.11.9/plugin/relativeTime.min.js,npm/dayjs@1.11.9/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script> /* Note: dependent library will be loaded in `js-selector.html` */ SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<article class="px-1 px-sm-2 px-lg-4 px-xl-0"><header><h2><a href="{url}">{title}</a></h2><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div></header><p>{snippet}</p></article>', noResultsText: '<p class="mt-5"></p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
